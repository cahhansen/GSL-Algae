{
    "collab_server" : "",
    "contents" : "library(RMySQL)\nlibrary(ggplot2)\nlibrary(lubridate)\nlibrary(scales)\nlibrary(leaps)\n\n\n#Stepwise Model------------------------------------------------------------------------\nstepwisechlmodel=function(month,dataframe){\n  dataframe=dataframe[(dataframe$Month==month),]\n  dataframe=dataframe[,c(1:6,8,22:38)]\n  mod1=glm(FieldValue~.,data=dataframe,family=gaussian(link=\"log\"))\n  mod0=glm(FieldValue~1,data=dataframe,family=gaussian(link=\"log\"))\n  mod=step(mod0,scope=formula(mod1),trace=0)\n  print(mod$coefficients)\n  print(summary(mod))\n}\n\n#Regression Subset Model----------------------------------------------------------------\nregsubmodel=function(month,dataframe){\n  dataframe=dataframe[(dataframe$Month==month),]\n  dataframe=dataframe[,c(1:6,8,22:38)]\n  models=regsubsets(log(FieldValue)~.,data=dataframe)\n  p1=plot(models,scale=\"adjr2\")\n  p2=plot(models,scale=\"bic\")\n  return(list(p1,p2))\n}\n\n#Apply Model and Look at its Performance in Predicting----------------------------------\n#For a model with known coefficients, use the following function to explore the model performance\nmodelperform=function(mod,caldata,applydata,month){\n  predicted=(mod$fitted.values)\n  print(summary(predicted))\n  compare=data.frame(predicted)\n  compare$actual=caldata$FieldValue\n  compare$diff=compare$actual-compare$predicted\n  #Compute RMSE\n  rmse=sqrt(mean(compare$diff)^2)\n  print(paste(\"RMSE is: \",rmse))\n  print(summary(lm(compare$actual~compare$predicted))$r.squared)\n  summary(mod)\n  #Apply model to historic dataset\n  applydata=applydata[(applydata$Month==month),]\n  predvals=predict(mod,newdata=applydata,type=\"response\",se.fit=TRUE)\n  modeledvals=predvals$fit\n  limits=aes(ymax =predvals$fit+1.96*predvals$se.fit,ymin=predvals$fit-1.96*predvals$se.fit)\n  applydata$Value=modeledvals\n  return(applydata)\n}\n\n#Plot estimates with error bars ------------------------------------------------\nplotrsest=function(applydata,month){\np1=ggplot(applydata, aes(colour=as.factor(StationID), y=Value, x=Date))+\n  geom_point() + geom_errorbar(limits, width=0.2)+theme_bw()+\n  scale_color_discrete(name=\"Station ID\")+ggtitle(paste0(\"Predicted Values with Confidence Intervals, Month: \",month))+\n  ylab(\"Predicted Chl-a (ug/L)\")\nreturn(p1)\n}\n\n#Combine data used for calibration and for application------------------------------\nestimatedrecord=rbind(june,july,august,sept)\nestimatedrecord=estimatedrecord[,c(11,7,31,10,30)]\nestimatedrecord$Dataset='Estimates'\nmodcal_format=modcal\nmodcal_format$Date=modcal_format$SamplingDate\nmodcal_format$Value=modcal_format$FieldValue\nmodcal_format=modcal_format[,c(41,9,42,18,40,22)]\ncompleterecord=rbind(estimatedrecord,modcal_format)\n\nwrite.csv(completerecord,'RemoteSensingPaper/UtahLakeEstimatedRecord.csv')\n\n\n#Plot Estimated values (with Calibration data)\nggplot(completerecord)+geom_point(aes(x=Date,y=Value,col=as.factor(Dataset)))+\n  xlab(\"Date\")+ylab(\"Estimated Value of Surface Chlorophyll, ug/L\")+theme_bw()+\n  scale_x_date(labels = date_format(\"%Y\"), breaks = date_breaks(\"year\"))+\n  scale_y_continuous(limits=c(0,350))+\n  theme(legend.position=\"bottom\",axis.title.x = element_text(face=\"bold\", size=14),\n        axis.text.x  = element_text(angle=45, vjust=0.5, size=12),axis.title.y = element_text(face=\"bold\", size=14),\n        axis.text.y  = element_text(size=12))+scale_color_discrete(name  =\"Dataset\")+\n  scale_y_continuous(limits=c(0,350))+\n  scale_x_date(labels = date_format(\"%Y\"), breaks = date_breaks(\"2 year\"),limits=c(as.Date(\"1984-01-01\"),as.Date(\"2016-12-31\")))\n\n\nfieldrecord=read.csv('Field Data/GSLSWSData.csv')\nUtah=fieldrecord[(fieldrecord$Lake=='Utah'),]\nUtah=Utah[(Utah$Value>0),]\nUtah$Date=as.Date(Utah$Date,format=\"%m/%d/%Y\")\n#Plot Historical Field Record\nggplot(Utah)+geom_point(aes(x=Date,y=Value,col=as.factor(StationID)))+\n  xlab(\"Date\")+ylab(\"Field-Measured Value \\nof Surface Chlorophyll, ug/L\")+theme_bw()+\n  theme(legend.position=\"bottom\",axis.title.x = element_text(face=\"bold\", size=14),\n        axis.text.x  = element_text(angle=45, vjust=0.5, size=12),axis.title.y = element_text(face=\"bold\", size=14),\n        axis.text.y  = element_text(size=12))+scale_color_discrete(name  =\"Station\")+\n  scale_y_continuous(limits=c(0,350))+\n  scale_x_date(labels = date_format(\"%Y\"), breaks = date_breaks(\"2 year\"),limits=c(as.Date(\"1984-01-01\"),as.Date(\"2016-12-31\")))\n\n\n#Plot Historical Field Record with Estimates on same plot\nggplot()+geom_point(aes(x=Utah$Date,y=Utah$Value))+geom_point(aes(x=completerecord$Date,y=completerecord$Value,col=as.factor(completerecord$StationID)))+\n  xlab(\"Date\")+ylab(\"Field-Measured or Estimated Value \\nof Surface Chlorophyll, ug/L\")+theme_bw()+\n  theme(legend.position=\"bottom\",axis.title.x = element_text(face=\"bold\", size=14),\n        axis.text.x  = element_text(angle=45, vjust=0.5, size=12),axis.title.y = element_text(face=\"bold\", size=14),\n        axis.text.y  = element_text(size=12))+scale_color_discrete(name  =\"Station\")+\n  scale_y_continuous(limits=c(0,350))+\n  scale_x_date(labels = date_format(\"%Y\"), breaks = date_breaks(\"2 year\"),limits=c(as.Date(\"1984-01-01\"),as.Date(\"2016-12-31\")))\n\nUtah$Sensor=NA\nUtah$Month=month(Utah$Date)\nUtah$DOY=yday(Utah$Date)\nUtah$Dataset=\"Measurement\"\ncomplete.record=rbind(estimatedrecord,Utah[,c(1,3,2,13,15,16)])\n\nwrite.csv(complete.record,'RemoteSensingPaper/UtahLakeCompleteRecord.csv')\n",
    "created" : 1479831802038.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1258445789",
    "id" : "9B5E0133",
    "lastKnownWriteTime" : 1479959869,
    "last_content_update" : 1479959869426,
    "path" : "C:/Users/Carly/Google Drive/University of Utah - Research/Dissertation Research/RemoteSensingPaper/ModelDevelopment/ModelDevelopment_LS57.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}